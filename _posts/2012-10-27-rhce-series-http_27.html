---
layout: post
title: 'RHCE Series: HTTP'
date: '2012-10-27T17:16:00.001-05:00'
author: jtdub
tags:
- Linux
- RHCE Study Notes
- Apache
- http
modified_time: '2019-04-11T11:09:49.249-05:00'
blogger_id: tag:blogger.com,1999:blog-2200496390325245811.post-4325617279771370502
blogger_orig_url: https://www.packetgeek.net/2012/10/rhce-series-http_27.html
---

<ul><br/>	<li>Configure a virtual host.</li><br/>	<li>Configure private directories.</li><br/>	<li>Deploy a basic CGI application.</li><br/>	<li>Configure group-managed content.</li><br/></ul><br/>Install apache:<br/><br/>yum -y install httpd httpd-manual links<br/><br/>The httpd-manual is a great resource for information, but isn't needed. The links package is needed for the server-status utilities.<br/><br/>First, let's create our virtual hosts. We'll need to create our DocumentRoot directories.<br/><br/>&nbsp;<br/><pre>[root@server1 ~]# mkdir /var/www/{server1.example.com,vhost.server1.example.com}<br/>[root@server1 ~]# ls /var/www/<br/>cgi-bin  error  html  icons  manual  server1.example.com  vhost.server1.example.com</pre><br/>Next, you'll need to edit the /etc/httpd/conf/httpd.conf<br/><br/>&nbsp;<br/><pre>[root@server1 ~]# cd /etc/httpd/conf<br/>[root@server1 conf]# vim httpd.conf <br/>[root@server1 conf]# tail httpd.conf <br/>#<br/>NameVirtualHost *:80<br/><br/> DocumentRoot /var/www/server1.example.com<br/> ServerName server1.example.com<br/><br/><br/> DocumentRoot /var/www/vhost.server1.example.com<br/> ServerName vhost.server1.example.com</pre><br/>When you enable virtual hosts in apache, the default website in /var/www/html will not work. You will have to add another virtual host if you want to serve content from that directory. In this configuration, apache will intercept the http headers and look at the destination url and direct traffic based upon that information.<br/><br/>Now that the httpd.conf has been modified, we'll need to restart apache.<br/><br/>&nbsp;<br/><pre>[root@server1 ~]# service httpd restart<br/>Stopping httpd:                                            [  OK  ]<br/>Starting httpd:                                            [  OK  ]<br/>[root@server1 ~]# httpd -S<br/>VirtualHost configuration:<br/>wildcard NameVirtualHosts and _default_ servers:<br/>_default_:8443         server1.example.com (/etc/httpd/conf.d/nss.conf:84)<br/>*:80                   is a NameVirtualHost<br/>         default server server1.example.com (/etc/httpd/conf/httpd.conf:1011)<br/>         port 80 namevhost server1.example.com (/etc/httpd/conf/httpd.conf:1011)<br/>         port 80 namevhost vhost.server1.example.com (/etc/httpd/conf/httpd.conf:1015)<br/>Syntax OK<br/>[root@server1 ~]# apachectl status<br/>                                   Not Found<br/><br/>   The requested URL /server-status was not found on this server.<br/><br/>     ----------------------------------------------------------------------<br/><br/>    Apache/2.2.15 (CentOS) Server at localhost Port 80</pre><br/>You'll notice that you can use the 'httpd -S' command to show the virtual hosts residing on the server. Let's create some content to view in the virtual hosts.<br/><br/>&nbsp;<br/><pre>[root@server1 ~]# echo "server1.example.com" &gt; /var/www/server1.example.com/index.htm<br/>[root@server1 ~]# echo "vhost.server1.example.com" &gt; /var/www/vhost.server1.example.com/index.htm</pre><br/>Now, let's try to view the content.<br/><br/>&nbsp;<br/><pre>[root@server1 ~]# ping -c 1 server1.example.com<br/>PING server1.example.com (192.168.1.1) 56(84) bytes of data.<br/>64 bytes from server1.example.com (192.168.1.1): icmp_seq=1 ttl=64 time=0.042 ms<br/><br/>--- server1.example.com ping statistics ---<br/>1 packets transmitted, 1 received, 0% packet loss, time 0ms<br/>rtt min/avg/max/mdev = 0.042/0.042/0.042/0.000 ms<br/>[root@server1 ~]# ping -c 1 vhost.server1.example.com<br/>PING server1.example.com (192.168.1.1) 56(84) bytes of data.<br/>64 bytes from server1.example.com (192.168.1.1): icmp_seq=1 ttl=64 time=0.028 ms<br/><br/>--- server1.example.com ping statistics ---<br/>1 packets transmitted, 1 received, 0% packet loss, time 0ms<br/>rtt min/avg/max/mdev = 0.028/0.028/0.028/0.000 ms<br/>[root@server1 ~]# curl -I server1.example.com<br/>HTTP/1.1 403 Forbidden<br/>Date: Sun, 28 Oct 2012 02:54:16 GMT<br/>Server: Apache/2.2.15 (CentOS)<br/>Accept-Ranges: bytes<br/>Content-Length: 5039<br/>Connection: close<br/>Content-Type: text/html; charset=UTF-8<br/><br/>[root@server1 ~]# curl -I vhost.server1.example.com<br/>HTTP/1.1 403 Forbidden<br/>Date: Sun, 28 Oct 2012 02:54:24 GMT<br/>Server: Apache/2.2.15 (CentOS)<br/>Accept-Ranges: bytes<br/>Content-Length: 5039<br/>Connection: close<br/>Content-Type: text/html; charset=UTF-8</pre><br/>A quick peak at the error_log shows why we can't view the page(s).<br/><pre>[root@server1 ~]# tail -f /var/log/httpd/error_log <br/>[Sat Oct 27 21:48:58 2012] [notice] SELinux policy enabled; httpd running as context unconfined_u:system_r:httpd_t:s0<br/>[Sat Oct 27 21:48:58 2012] [notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)<br/>[Sat Oct 27 21:48:58 2012] [notice] Digest: generating secret for digest authentication ...<br/>[Sat Oct 27 21:48:58 2012] [notice] Digest: done<br/>[Sat Oct 27 21:48:59 2012] [notice] Apache/2.2.15 (Unix) DAV/2 mod_nss/2.2.15 NSS/3.13.1.0 Basic ECC configured -- resuming normal operations<br/>[Sat Oct 27 21:49:06 2012] [error] [client 127.0.0.1] File does not exist: /var/www/server1.example.com/server-status<br/>[Sat Oct 27 21:54:16 2012] [error] [client 192.168.1.1] Directory index forbidden by Options directive: /var/www/server1.example.com/<br/>[Sat Oct 27 21:54:24 2012] [error] [client 192.168.1.1] Directory index forbidden by Options directive: /var/www/vhost.server1.example.com/<br/>[Sat Oct 27 21:54:56 2012] [error] [client 192.168.1.1] Directory index forbidden by Options directive: /var/www/server1.example.com/<br/>[Sat Oct 27 21:55:06 2012] [error] [client 192.168.1.1] Directory index forbidden by Options directive: /var/www/vhost.server1.example.com/</pre><br/>Notice, that I labeled the index files index.htm. Be default, index.html and index.html.var are the default index pages AND apache, by default, doesn't print a directory listing as a default index page if a index.html or index.html.var page doesn't exist. So, to fix this, I had to add index.htm to the "DirectoryIndex" directive in the httpd.conf<br/><pre>#<br/># DirectoryIndex: sets the file that Apache will serve if a directory<br/># is requested.<br/>#<br/># The index.html.var file (a type-map) is used to deliver content-<br/># negotiated documents.  The MultiViews Option can be used for the <br/># same purpose, but it is much slower.<br/>#<br/>DirectoryIndex index.html index.html.var index.htm</pre><br/>Now, let's try this again.<br/><pre>[root@server1 ~]# vim /etc/httpd/conf/httpd.conf <br/>[root@server1 ~]# service httpd restart<br/>Stopping httpd:                                            [  OK  ]<br/>Starting httpd:                                            [  OK  ]<br/>[root@server1 ~]# <br/>[root@server1 ~]# <br/>[root@server1 ~]# curl -I server1.example.com<br/>HTTP/1.1 200 OK<br/>Date: Sun, 28 Oct 2012 03:05:43 GMT<br/>Server: Apache/2.2.15 (CentOS)<br/>Last-Modified: Sun, 28 Oct 2012 02:52:13 GMT<br/>ETag: "4d12-14-4cd15a3d274c1"<br/>Accept-Ranges: bytes<br/>Content-Length: 20<br/>Connection: close<br/>Content-Type: text/html; charset=UTF-8<br/><br/>[root@server1 ~]# curl -I vhost.server1.example.com<br/>HTTP/1.1 200 OK<br/>Date: Sun, 28 Oct 2012 03:05:54 GMT<br/>Server: Apache/2.2.15 (CentOS)<br/>Last-Modified: Sun, 28 Oct 2012 02:52:26 GMT<br/>ETag: "4d32-1a-4cd15a49dd342"<br/>Accept-Ranges: bytes<br/>Content-Length: 26<br/>Connection: close<br/>Content-Type: text/html; charset=UTF-8<br/><br/>[root@server1 ~]# curl vhost.server1.example.com<br/>vhost.server1.example.com<br/>[root@server1 ~]# curl server1.example.com<br/>server1.example.com<br/>[root@server1 ~]# ls -Z /var/www/<br/>drwxr-xr-x. root root system_u:object_r:httpd_sys_script_exec_t:s0 cgi-bin<br/>drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 error<br/>drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 html<br/>drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 icons<br/>drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 manual<br/>drwxr-xr-x. root root unconfined_u:object_r:httpd_sys_content_t:s0 server1.example.com<br/>drwxr-xr-x. root root unconfined_u:object_r:httpd_sys_content_t:s0 vhost.server1.example.com<br/>[root@server1 ~]# ls -Z /var/www/*example.com/<br/>/var/www/server1.example.com/:<br/>-rw-r--r--. root root unconfined_u:object_r:httpd_sys_content_t:s0 index.htm<br/><br/>/var/www/vhost.server1.example.com/:<br/>-rw-r--r--. root root unconfined_u:object_r:httpd_sys_content_t:s0 index.htm</pre><br/>Now, the sites are working. So, let's go on to the next objective of configuring private directories.<br/><br/>We'll set up vhost.server1.example.com to create a private directory with.<br/><br/>&nbsp;<br/><pre>[root@server1 ~]# htpasswd -cm /var/www/vhost.server1.example.com/.htpasswd james<br/>New password: <br/>Re-type new password: <br/>Adding password for user james<br/>[root@server1 ~]# cat /var/www/vhost.server1.example.com/.htpasswd <br/>james:$apr1$dTUr3R1T$l77COVCwfP0ZKoF05Vq081<br/>[root@server1 ~]# vim /etc/httpd/conf/httpd.conf <br/>[root@server1 ~]# tail -6 /etc/httpd/conf/httpd.conf <br/><br/> AuthType Basic<br/> AuthName "Private"<br/> AuthUserFile /var/www/vhost.server1.example.com/.htpasswd<br/> Require valid-user<br/><br/>[root@server1 ~]# service httpd restart<br/>Stopping httpd:                                            [  OK  ]<br/>Starting httpd:                                            [  OK  ]<br/>[root@server1 ~]# curl -I vhost.server1.example.com<br/>HTTP/1.1 401 Authorization Required<br/>Date: Sun, 28 Oct 2012 03:42:59 GMT<br/>Server: Apache/2.2.15 (CentOS)<br/>WWW-Authenticate: Basic realm="Private"<br/>Connection: close<br/>Content-Type: text/html; charset=iso-8859-1<br/><br/>[root@server1 ~]# curl --user james:testuser vhost.server1.example.com<br/>vhost.server1.example.com</pre><br/>Now, let's go ahead and set up group managed content, then we'll deploy a cgi application.<br/><br/>&nbsp;<br/><pre>[root@server1 ~]# echo "sysadmin: james user1 user2" &gt; /var/www/vhost.server1.example.com/.htgroup <br/>[root@server1 ~]# cat /var/www/vhost.server1.example.com/.htgroup <br/>sysadmin: james user1 user2<br/>[root@server1 ~]# vim /etc/httpd/conf/httpd.conf <br/>[root@server1 ~]# tail -7 /etc/httpd/conf/httpd.conf <br/><br/> AuthType Basic<br/> AuthName "Private"<br/> AuthUserFile /var/www/vhost.server1.example.com/.htpasswd<br/> AuthGroupFile /var/www/vhost.server1.example.com/.htgroup<br/> Require group sysadmin<br/><br/>[root@server1 ~]# service httpd restart<br/>Stopping httpd:                                            [  OK  ]<br/>Starting httpd:                                            [  OK  ]<br/>[root@server1 ~]# curl -I vhost.server1.example.com<br/>HTTP/1.1 401 Authorization Required<br/>Date: Sun, 28 Oct 2012 03:49:50 GMT<br/>Server: Apache/2.2.15 (CentOS)<br/>WWW-Authenticate: Basic realm="Private"<br/>Connection: close<br/>Content-Type: text/html; charset=iso-8859-1<br/><br/>[root@server1 ~]# curl --user james:testuser vhost.server1.example.com<br/>vhost.server1.example.com</pre><br/>This time, the user 'james' was allowed because the user was in the 'sysadmin' group. Now the cgi application.<br/><pre>[root@server1 ~]# vim /var/www/cgi-bin/hello.cgi<br/>[root@server1 ~]# chmod +x /var/www/cgi-bin/hello.cgi <br/>[root@server1 ~]# cat /var/www/cgi-bin/hello.cgi <br/>#!/usr/bin/perl<br/><br/>print "Content-type: text/html\r\n\n";<br/><br/>print "Hello!\n";<br/>[root@server1 ~]# curl -I server1.example.com/cgi-bin/hello.cgi<br/>HTTP/1.1 200 OK<br/>Date: Sun, 28 Oct 2012 04:01:36 GMT<br/>Server: Apache/2.2.15 (CentOS)<br/>Connection: close<br/>Content-Type: text/html; charset=UTF-8<br/><br/>[root@server1 ~]# curl server1.example.com/cgi-bin/hello.cgi<br/>Hello!</pre><br/>The last and final objective, though not on the RHCE offical list, it's a useful tool for working with httpd servers. Setting up the server-status tool.<br/><br/>First, you'll need to edit the httpd.conf.<br/><pre class="crayon-selected">#<br/># Allow server status reports generated by mod_status,<br/># with the URL of http://servername/server-status<br/># Change the ".example.com" to match your domain to enable.<br/>#<br/>ExtendedStatus On<br/><br/>    SetHandler server-status<br/>    Order deny,allow<br/>    Deny from all<br/>    Allow from 127.0.0.1 <br/><br/>[root@server1 ~]# service httpd restart<br/>Stopping httpd:                                            [  OK  ]<br/>Starting httpd:                                            [  OK  ]<br/>[root@server1 ~]# apachectl fullstatus<br/>                       Apache Server Status for localhost<br/><br/>   Server Version: Apache/2.2.15 (Unix) DAV/2 mod_nss/2.2.15 NSS/3.13.1.0<br/>   Basic ECC<br/><br/>   Server Built: Feb 13 2012 22:31:42<br/><br/>     ----------------------------------------------------------------------<br/><br/>   Current Time: Saturday, 27-Oct-2012 23:07:09 CDT<br/><br/>   Restart Time: Saturday, 27-Oct-2012 23:06:51 CDT<br/><br/>   Parent Server Generation: 0<br/><br/>   Server uptime: 18 seconds<br/><br/>   Total accesses: 1 - Total Traffic: 2 kB<br/><br/>   CPU Usage: u.08 s.01 cu0 cs0 - .5% CPU load<br/><br/>   .0556 requests/sec - 113 B/second - 2048 B/request<br/><br/>   1 requests currently being processed, 7 idle workers<br/><br/> __W_____........................................................<br/> ................................................................<br/> ................................................................<br/> ................................................................<br/><br/>   Scoreboard Key:<br/>   "_" Waiting for Connection, "S" Starting up, "R" Reading Request,<br/>   "W" Sending Reply, "K" Keepalive (read), "D" DNS Lookup,<br/>   "C" Closing connection, "L" Logging, "G" Gracefully finishing,<br/>   "I" Idle cleanup of worker, "." Open slot with no current process<br/><br/>Srv PID   Acc  M CPU  SS Req Conn Child Slot  Client          VHost           Request     <br/>                                                                           GET            <br/>0-0 3474 0/1/1 _ 0.09 4  5   0.0  0.00  0.00 127.0.0.1 server1.example.com /server-status <br/>                                                                           HTTP/1.1       <br/>                                                                           GET            <br/>2-0 3476 0/0/0 W 0.00 0  0   0.0  0.00  0.00 127.0.0.1 server1.example.com /server-status <br/>                                                                           HTTP/1.1       <br/><br/>     ----------------------------------------------------------------------<br/><br/>    Srv  Child Server number - generation                            <br/>    PID  OS process ID                                               <br/>    Acc  Number of accesses this connection / this child / this slot <br/>     M   Mode of operation                                           <br/>    CPU  CPU usage, number of seconds                                <br/>    SS   Seconds since beginning of most recent request              <br/>    Req  Milliseconds required to process most recent request        <br/>   Conn  Kilobytes transferred this connection                       <br/>   Child Megabytes transferred this child                            <br/>   Slot  Total megabytes transferred this slot                       <br/><br/>     ----------------------------------------------------------------------<br/><br/>    Apache/2.2.15 (CentOS) Server at localhost Port 80</pre><br/>You can use 'apachectl status|fullstatus' to get real time statistics of the web server utilization.