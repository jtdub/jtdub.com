---
layout: post
title: Configuring Cisco routers and switches with Python
date: '2013-10-08T11:28:00.001-05:00'
author: jtdub
tags:
- Cisco Administration Python Scripting
- IOS
- Python Tips
- Cisco Administration Perl Scripting
modified_time: '2019-04-11T11:09:58.395-05:00'
blogger_id: tag:blogger.com,1999:blog-2200496390325245811.post-1308249714229899832
blogger_orig_url: https://www.packetgeek.net/2013/10/configuring-cisco-routers-and-switches_8.html
---
<em>
 <strong>
  Update
 </strong>
</em>
: I've updated the multichange script a lot since I first wrote about it. You can use the category function to see the
<a href="http://www.packetgeek.net/category/python-tips/">
 various posts
</a>
.
<br/>
<br/>
You can also look at my
<a href="http://github.com/jtdub" target="_blank">
 github
</a>
for
<a href="https://github.com/jtdub/pyRouterLib" target="_blank">
 pyRouterLib
</a>
and
<a href="https://github.com/jtdub/pyMultiChange" target="_blank">
 pyMultiChange
</a>
.
<br/>
<br/>
In my new job role, I've been rediscovering the limitations of the Perl Module
<a href="http://search.cpan.org/~joshua/Net-Telnet-Cisco-1.10/Cisco.pm" target="_blank">
 Net::Telnet::Cisco
</a>
when executing mass changes to network devices, so I've been looking for alternatives. Particularly, Net::Telnet::Cisco doesn't play nicely with NX-OS, IOS-XR, or Arista EOS - without a major re-write. So, I've been experimenting with a Python implementation. Below is what I have so far, which is working well, but is far from production ready.
<br/>
<pre class="lang:default decode:true">$ cat pymultichange.py <br/>#!/usr/bin/env python<br/><br/>import getpass<br/>import sys<br/>import telnetlib<br/>import os<br/><br/># Variables<br/>tacacs = '.tacacslogin'<br/>commandsfile = 'commands.txt'<br/>hostsfile = 'hosts.txt'<br/>devicetype = "ios"<br/>verbose = "yes"<br/><br/>def userlogin():<br/>    # Getting login credentials<br/>    global username, password, enable<br/>    if os.path.isfile(tacacs):<br/>        login = open(tacacs, "r")<br/>        username = login.readline()<br/>        username = username.replace("\n", "")<br/>        password = login.readline()<br/>        password = password.replace("\n", "")<br/>        enable = login.readline()<br/>        enable = enable.replace("\n", "")<br/>        login.close()<br/>    else:<br/>        print tacacs, "not found.\n"<br/>        username = raw_input("Username: ")<br/>        password = getpass.getpass("User Password: ")<br/>        enable = getpass.getpass("Enable Password: ")<br/><br/>    return username, password, enable<br/><br/>def login(devicetype):<br/>    # Logging in with username, password, and eable password<br/>    global username, password, enable<br/>    if devicetype == "nexus":<br/>        telnet.read_until("Login: ")<br/>        telnet.write(str(username) + "\n")<br/>    else:<br/>        telnet.read_until("Username: ")<br/>        telnet.write(str(username) + "\n")<br/><br/>    if password:<br/>        telnet.read_until("Password: ")<br/>        telnet.write(str(password) + "\n")<br/><br/>    if devicetype == "ios":<br/>        if enable:<br/>            telnet.read_until(host2login + '&gt;')<br/>            telnet.write("enable\n")<br/>            telnet.read_until("Password: ")<br/>            telnet.write(str(enable) + "\n")<br/><br/>def sessioncommands():<br/>    # Executing commands on the host<br/>    global commands<br/>    print "Executing Commands on", host2login<br/>    if os.path.isfile(commandsfile):<br/>        commands = open(commandsfile, "r")<br/>        try:<br/>            for cmd2exe in commands:<br/>                telnet.write(cmd2exe)<br/>        finally:<br/>            commands.close()<br/>    else:<br/>        print commandsfile, " doesn't exist"<br/>        telnet.write("exit\n")<br/>    # Displaying the results<br/>    if verbose == "yes":<br/>        output = telnet.read_all()<br/>        if "% " in output:<br/>            print "Error: ", output<br/>            sys.exit()<br/>        else:<br/>            print output<br/><br/>    print "Logging out of", host2login<br/><br/># Doing work <br/>userlogin()<br/>if os.path.isfile(hostsfile):<br/>    hosts = open(hostsfile, "r")<br/>    while 1:<br/>        host2login = hosts.readline()<br/>        host2login = host2login.replace("\n", "")<br/>        print "Logging into", host2login<br/>        if not host2login:<br/>            break<br/>        else:<br/>            telnet = telnetlib.Telnet(host2login)<br/>            login(devicetype)<br/>            sessioncommands()<br/>    hosts.close()<br/>else:<br/>    host2login = raw_input("Host: ")<br/>    print "Logging into", host2login<br/>    telnet = telnetlib.Telnet(host2login)<br/>    login(devicetype)<br/>    sessioncommands()<br/></pre>
<br/>
I need to implement the
<a href="http://docs.python.org/2/library/getopt.html#module-getopt" target="_blank">
 getopt
</a>
Python module to make it more command line friendly. I'm sure that I'll also find some tweaks that I need to make here and there as I experiment with other devices. So far, it works pretty well with IOS devices. I'll post updates as it becomes more stable, user friendly, and over all useful. This is just what I've come up with in a couple hours of tinkering and reteaching myself Python.
