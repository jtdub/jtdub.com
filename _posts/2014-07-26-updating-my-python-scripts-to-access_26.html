---
layout: post
title: Updating my Python Scripts to access Cisco Devices
date: '2014-07-26T14:18:00.001-05:00'
author: jtdub
tags:
- Cisco Administration Python Scripting
- Python Tips
modified_time: '2019-04-11T11:10:01.783-05:00'
blogger_id: tag:blogger.com,1999:blog-2200496390325245811.post-1424584288481517983
blogger_orig_url: https://www.packetgeek.net/2014/07/updating-my-python-scripts-to-access_26.html
---

I've been working to migrate my python scripts, that access Cisco routers and switches to utilize SSH. I'm building out a 'pyRouterLib' class, that currently doesn't have much functionality, but I'm going to be building it out a lot more in the coming months. I'm also working on my pyMultiChange script, so that it utilizes SSH as well. Currently, the work is going well, although, there is still more work to go.
<br/>
<br/>
Here is the pyRouterLib library:
<br/>
<pre class="lang:default decode:true">#!/usr/bin/env python<br/><br/>class pyRouterLib:<br/>	'''<br/>	Requirments:<br/>	*** Modules:<br/>		os, getpass, paramiko, logging<br/>	'''<br/>	<br/>	def __init__(self, host):<br/>		self.host = host<br/>	<br/>	''' Granular debugging that assists in trouble shooting issues '''<br/>	def debug(self):<br/>		import logging<br/>		logging.basicConfig(level=logging.DEBUG)<br/>	<br/>	''' Define where to get user credentials '''<br/>	def get_creds(self):<br/>		from os.path import expanduser<br/>		import os.path<br/>		homeDir = expanduser("~")<br/>		credsFile = ".tacacslogin"<br/>		credsFile = homeDir + "/" + credsFile<br/>		<br/>		if os.path.isfile(credsFile):<br/>			print "Using existing credentials file."<br/>			credsFileLocation = open(credsFile)<br/>			self.username = credsFileLocation.readline()<br/>			self.username = self.username.strip('\n')<br/>			self.password = credsFileLocation.readline()<br/>			self.password = self.password.strip('\n')<br/>			self.enable = credsFileLocation.readline()<br/>			self.enable = self.enable.strip('\n')<br/>			credsFileLocation.close()<br/>		else:<br/>			import getpass<br/>			print "You have not created a credentials file. Lets create one..."<br/>			self.username = raw_input("Username: ")<br/>			self.password = getpass.getpass("User Password: ")<br/>			self.enable = getpass.getpass("Enable Password: ")<br/>			<br/>			authFile = open(credsFile, 'w+')<br/>			authFile.write(self.username + "\n")<br/>			authFile.write(self.password + "\n")<br/>			authFile.write(self.enable + "\n")<br/>			authFile.close()<br/>				<br/>			print "Your credentials file has been created and is located at: "<br/>			print credsFile + "\n"<br/><br/>		username = self.username<br/>		password = self.password<br/>		enable = self.enable<br/>		<br/>		return username, password, enable<br/></pre>
<br/>
Here is the pyMultiShow.py script, which utilizes the pyRouterLib to obtain user credentials:
<br/>
<pre class="lang:default decode:true">#!/usr/bin/env python<br/><br/>from pyRouterLib import *<br/>import os, argparse, paramiko, time<br/><br/>''' Define hosts file, command file, verbose variables '''<br/>hosts_file = ''<br/>cmd_file = ''<br/>verbose = False<br/><br/>def arguments():<br/>	''' Function to define the script command line arguments '''<br/>	global hosts_file, cmd_file, verbose<br/>	<br/>	parser = argparse.ArgumentParser(description='A Python implementation of MultiChange, which allows you to make mass changes to routers and switches via SSH.')<br/>	parser.add_argument('-d', '--hosts', help='Specify a host file', required=True)<br/>	parser.add_argument('-c', '--commands', help='Specify a commands file', required=True)<br/>	parser.add_argument('-v', '--verbose', nargs='?', default=False, help='Enables a verbose debugging mode')<br/><br/>	args = vars(parser.parse_args())<br/><br/>	if args['hosts']:<br/>		hosts_file = args['hosts']<br/>	if args['commands']:<br/>		cmd_file = args['commands']<br/>	if args['verbose'] == None:<br/>		verbose = True<br/>	<br/>	return hosts_file, cmd_file, verbose<br/><br/>arguments()<br/><br/>''' open the hosts file and commands file and execute each command on every host '''<br/>if os.path.isfile(hosts_file):<br/>	hosts = open(hosts_file, 'r')<br/>	for host in hosts:<br/>		host = host.strip("\n")<br/>		<br/>		''' use pyRouterLib to grab the user authentication credentials '''<br/>		rlib = pyRouterLib(host)<br/>		creds = rlib.get_creds()<br/>		username = creds[0]<br/>		password = creds[1]<br/>		enable = creds[2]<br/>		<br/>		''' Enable verbose debugging '''<br/>		if verbose:<br/>			rlib.debug()<br/>		<br/>		remoteConnectionSetup = paramiko.SSHClient()<br/>		remoteConnectionSetup.set_missing_host_key_policy(paramiko.AutoAddPolicy())<br/>		remoteConnectionSetup.connect(host, username=username, password=password, allow_agent=False, look_for_keys=False)<br/>		print "*** SSH connection established to %s" % host<br/>		remoteConnection = remoteConnectionSetup.invoke_shell()<br/>		print "*** Interactive SSH session established"<br/>		cmds = open(cmd_file, 'r')<br/>		for command in cmds:<br/>			remoteConnection.send(command)<br/>			print "*** Executing Command: %s" % command<br/>			if verbose:<br/>				time.sleep(2)<br/>				output = remoteConnection.recv(10000)<br/>				print output<br/>		cmds.close()<br/>		print "*** Closing Connection to %s" % host<br/>	hosts.close()</pre>
<br/>
Both can be accessed from my
<a href="https://github.com/jtdub/pyRouterLib" target="_blank">
 github
</a>
.
