---
layout: post
title: Python with Multiple Threads
date: '2014-11-20T20:38:00.001-06:00'
author: jtdub
tags:
- Python Tips
modified_time: '2019-04-11T11:10:02.578-05:00'
blogger_id: tag:blogger.com,1999:blog-2200496390325245811.post-8392807734016848945
blogger_orig_url: https://www.packetgeek.net/2014/11/python-with-multiple-threads_20.html
---

I have a need to have a script to execute the same task, among many devices, as close to the same time as possible. As a non-programmer, whom happens to write code in an effort to make my job easier, I thought the task would be easier than it actually is. Spawning multiple threads is pretty easy. However, hitting resource limits is a limiting factor - as is how you output your data.
<br/>
<br/>
Here is an example of how I'm using BoundedSemaphores, within Python to limit the number of threads that I spawn.
<br/>
<pre class="show-plain-default:true lang:python decode:true">#!/usr/bin/env python<br/><br/>from threading import Thread<br/>from threading import BoundedSemaphore<br/>from os import system<br/>import time<br/><br/>threads = []<br/>max_threads = 1<br/>sema = BoundedSemaphore(value=max_threads)<br/>hosts = ['host1', 'host2', 'host3', 'host4', 'host5', 'host6']<br/><br/>def ping_pong(host, sema):<br/>	ping_pong_host = system('ping -c 100 -t 1 -m 1 %s &gt; /dev/null 2&gt;&amp;1' % host)<br/>	sema.release()<br/>	<br/>	return ping_pong_host<br/>	<br/>if __name__ == '__main__':<br/>	print "Start: %s" % time.time()<br/>	print "Max Threads: %s" % max_threads<br/>	tr = 1<br/>	for host in hosts:<br/>		print "Thread: %s - %s" % (tr, time.time())<br/>		sema.acquire()<br/>		t = Thread(target=ping_pong, args=[host, sema])<br/>		t.start()<br/>		threads.append(t)<br/>		tr += 1<br/>	for t in threads:<br/>		t.join()<br/>	print "End: %s" % time.time()</pre>
<br/>
With the 'max_threads' variable set to '1', here is the output:
<br/>
<pre class="lang:default decode:true">Start: 1416558663.05<br/>Max Threads: 1<br/>Thread: 1 - 1416558663.05<br/>Thread: 2 - 1416558663.05<br/>Thread: 3 - 1416558664.07<br/>Thread: 4 - 1416558665.08<br/>Thread: 5 - 1416558666.1<br/>Thread: 6 - 1416558667.12<br/>End: 1416558669.15</pre>
<br/>
With the 'max_threads' variable set to '6', here is the output:
<br/>
<pre class="lang:default decode:true">Start: 1416558829.13<br/>Max Threads: 6<br/>Thread: 1 - 1416558829.13<br/>Thread: 2 - 1416558829.13<br/>Thread: 3 - 1416558829.13<br/>Thread: 4 - 1416558829.13<br/>Thread: 5 - 1416558829.13<br/>Thread: 6 - 1416558829.13<br/>End: 1416558835.23</pre>
<br/>
With the max_threads set to one, it essentially disable's threading - in that it doesn't spawn multiple threads to complete a task. You can see that it took approximately five seconds to spawn all threads and another two seconds to complete the tasks.
<br/>
<br/>
With the max_threads set to six, it spawned all threads in less than a millisecond and took approximately six seconds to complete the tasks.
