---
layout: post
title: VLAN Trunking Protocol
date: '2010-07-27T17:25:00.001-05:00'
author: jtdub
tags:
- LAN Switching
- CCNA Study Notes
- CCNP Study Notes
- VTP
modified_time: '2019-04-11T11:09:39.067-05:00'
blogger_id: tag:blogger.com,1999:blog-2200496390325245811.post-8095467737849319051
blogger_orig_url: https://www.packetgeek.net/2010/07/vlan-trunking-protocol_27.html
---

VLAN Trunking Protocol, aka VTP, is a Cisco proprietary protocol that allows Cisco switches to manage your VLAN database across all switches in your LAN through a central switch. This is done via a client / server environment.
<br/>
<br/>
A switch can operate in three VTP modes. The first is server mode. This is the VTP server which hosts the VLAN database and other switches on the LAN communicate to obtain a copy of the VTP database. In server mode, a network admin can add and remove VLANs at will.
<br/>
<br/>
The second is client mode. This is a VTP client. These switches communicate with the VTP server to obtain the database. A network admin can not add or remove VLANs manually from a switch in client mode.
<br/>
<br/>
And finally the the third mode is transparent mode. In transparent mode, the switch does not communicate with the VTP server and does not act as a VTP client. The network admin can add and remove VLANs from a switch in transparent mode and it will also allow VTP traffic to pass through it to other switches participating in the VTP domain.
<br/>
<br/>
Misconfigured, VTP can cause a major headache, but fortunately, troubleshooting VTP is pretty straight forward.
<br/>
<br/>
1. For VTP to propagate to switches in VTP client mode, they need to be connected as trunk ports. Switches connected together in access mode will not propagate any VTP changes.
<br/>
<br/>
2.The "Configuration Revision" number should be the highest on the server VTP switch. If the client has a higher revision number, then it will fail to obtain updates from the server. If a switch is introduced to the network that is running in VTP server mode, has the same VTP domain name as your server, and has the same password that you've setup in your VTP domain, then it will over-write your VLAN database throughout your network.
<br/>
<br/>
3. The "Configuration last modified" should list the IP Address of your VTP server switch. If it's not, then you have a rogue VTP server on your network.
<br/>
<br/>
<pre>accessswitch#sh vtp status<br/>VTP Version                     : 2<br/>Configuration Revision          : 9<br/>Maximum VLANs supported locally : 255<br/>Number of existing VLANs        : 8<br/>VTP Operating Mode              : Client<br/>VTP Domain Name                 : rad<br/>VTP Pruning Mode                : Disabled<br/>VTP V2 Mode                     : Enabled<br/>VTP Traps Generation            : Disabled<br/>MD5 digest                      : 0x01 0x00 0xE6 0x40 0xE3 0x87 0x06 0x8C <br/>Configuration last modified by 10.10.10.1 at 3-1-93 00:07:31</pre>
<br/>
Fixing the issues are pretty straightforward, though may take a lot of manual input if you have a lot of VLANS.
<br/>
<br/>
1. If your client switches are not accepting updates from the server, verify that they are connected to the upstream switches via a trunking protocol. If that's correct, make sure that the "Configuration Revision" isn't higher than your VTP server. If it is, you can zero out the revision by changing to domain to null, changing the switch to server mode, then reconfiguring VTP in client mode.
<br/>
<br/>
2. If you have a rogue switch on the network that has taken over the role as VTP server, either remove the offending switch, or join it to the network in VTP client mode, then go to your VTP server and re-enter all your VLAN information in.
<i>
 You do have your VLAN information documented, right?
</i>
<br/>
<br/>
Other than that; use version 2, enable VTP pruning, use unique domain names, and use passwords on your VTP domain. If you're very paranoid, set all your switches to transparent mode and update the VLAN database on your switch infrastructure manually.
<br/>
<br/>
<b>
 Commands Sets:
</b>
<i>
</i>
<br/>
<br/>
<i>
 User EXEC mode:
</i>
<br/>
<br/>
show vtp counters
<br/>
show vtp status
<br/>
show vlan
<br/>
<br/>
<i>
 Global Configuration mode:
</i>
<br/>
<br/>
<pre>CSW1(config)#vtp ?<br/>  domain     Set the name of the VTP administrative domain.<br/>  file       Configure IFS filesystem file where VTP configuration is stored.<br/>  interface  Configure interface as the preferred source for the VTP IP updater<br/>             address.<br/>  mode       Configure VTP device mode<br/>  password   Set the password for the VTP administrative domain<br/>  pruning    Set the adminstrative domain to permit pruning<br/>  version    Set the adminstrative domain to VTP version<br/>CSW1(config)#vlan ?<br/>  WORD        ISL VLAN IDs 1-4094<br/>  access-map  Create vlan access-map or enter vlan access-map command mode<br/>  dot1q       dot1q parameters<br/>  filter      Apply a VLAN Map<br/>  internal    internal VLAN<br/></pre>
<br/>
<i>
 VLAN Configuration mode:
</i>
<br/>
<br/>
<pre>CSW1(config-vlan)#?<br/>VLAN configuration commands:<br/>  are           Maximum number of All Route Explorer hops for this VLAN (or<br/>                zero if none specified)<br/>  backupcrf     Backup CRF mode of the VLAN<br/>  bridge        Bridging characteristics of the VLAN<br/>  exit          Apply changes, bump revision number, and exit mode<br/>  media         Media type of the VLAN<br/>  mtu           VLAN Maximum Transmission Unit<br/>  name          Ascii name of the VLAN<br/>  no            Negate a command or set its defaults<br/>  parent        ID number of the Parent VLAN of FDDI or Token Ring type VLANs<br/>  private-vlan  Configure a private VLAN<br/>  remote-span   Configure as Remote SPAN VLAN<br/>  ring          Ring number of FDDI or Token Ring type VLANs<br/>  said          IEEE 802.10 SAID<br/>  shutdown      Shutdown VLAN switching<br/>  state         Operational state of the VLAN<br/>  ste           Maximum number of Spanning Tree Explorer hops for this VLAN (or<br/>                zero if none specified)<br/>  stp           Spanning tree characteristics of the VLAN<br/>  tb-vlan1      ID number of the first translational VLAN for this VLAN (or<br/>                zero if none)<br/>  tb-vlan2      ID number of the second translational VLAN for this VLAN (or<br/>                zero if none)<br/></pre>