---
layout: post
title: Managing Cisco Routers / Switches with Python, Take 2
date: '2013-10-10'
author: jtdub
tags:
- Cisco Administration Python Scripting
- IOS
- System Administration
- Python Tips
- packetgeek.net
---

Here is my script to date. It's functional and works pretty well, in my limited testing.
<br/>
<br/>
I'll put my future revisions on
<a href="https://github.com/jtdub/pyMultiChange/" target="_blank">
 github.com/jtdub/pyMultiChange
</a>
<br/>
<br/>
<pre class="lang:default decode:true">#!/usr/bin/env python<br/><br/>import getpass, sys, telnetlib, os, argparse<br/><br/># Variables<br/>tacacs = '.tacacslogin'<br/>verbose = False <br/>devicetype = 'ios'<br/>hostsfile = ''<br/>commandsfile = ''<br/><br/>def main():<br/>    # Parse and display argument variables<br/>    global verbose, devicetype, hostsfile, commandsfile<br/>    parser = argparse.ArgumentParser(description='Managing Cisco routers/switches with Python')<br/>    parser.add_argument('-d', '--hosts', help='Specifies a host file')<br/>    parser.add_argument('-c', '--commands',  help='Specifies a commands file', required=True)<br/>    parser.add_argument('-v', '--verbose', help='Be verbose with command output')<br/>    parser.add_argument('-n', '--nexus', help='Execute script assuming Nexus hosts')<br/><br/>    args = vars(parser.parse_args())<br/><br/>    if args['hosts']:<br/>        hostsfile = args['hosts'] <br/>    if args['commands']:<br/>        commandsfile = args['commands']<br/>    if args['verbose']:<br/>        args['verbose'] = True<br/>        verbose = args['verbose']<br/>    if args['nexus']:<br/>        devicetype = 'nexus'<br/><br/>    return hostsfile, commandsfile, devicetype, verbose<br/><br/>main()<br/><br/>def userlogin():<br/>    # Getting login credentials<br/>    global username, password, enable<br/>    if os.path.isfile(tacacs):<br/>        login = open(tacacs, "r")<br/>        username = login.readline()<br/>        username = username.replace("\n", "")<br/>        password = login.readline()<br/>        password = password.replace("\n", "")<br/>        enable = login.readline()<br/>        enable = enable.replace("\n", "")<br/>        login.close()<br/>    else:<br/>        print tacacs, "not found.\n"<br/>        username = raw_input("Username: ")<br/>        password = getpass.getpass("User Password: ")<br/>        enable = getpass.getpass("Enable Password: ")<br/><br/>    return username, password, enable<br/><br/>def login(devicetype):<br/>    # Logging in with username, password, and eable password<br/>    global username, password, enable<br/>    if devicetype == "nexus":<br/>        telnet.read_until("Login: ")<br/>        telnet.write(str(username) + "\n")<br/>    else:<br/>        telnet.read_until("Username: ")<br/>        telnet.write(str(username) + "\n")<br/><br/>    if password:<br/>        telnet.read_until("Password: ")<br/>        telnet.write(str(password) + "\n")<br/><br/>    if devicetype == "ios":<br/>        if enable:<br/>            telnet.read_until(host2login + '&gt;')<br/>            telnet.write("enable\n")<br/>            telnet.read_until("Password: ")<br/>            telnet.write(str(enable) + "\n")<br/><br/>def sessioncommands():<br/>    # Executing commands on the host<br/>    global commands<br/>    print "Executing Commands on", host2login<br/>    if os.path.isfile(commandsfile):<br/>        commands = open(commandsfile, "r")<br/>        try:<br/>            for cmd2exe in commands:<br/>                telnet.write(cmd2exe)<br/>        finally:<br/>            commands.close()<br/>    else:<br/>        print commandsfile, " doesn't exist"<br/>        telnet.write("exit\n")<br/>    # Displaying the results<br/>    if verbose == True:<br/>        output = telnet.read_all()<br/>        if "% " in output:<br/>            print "Error: ", output<br/>            sys.exit()<br/>        else:<br/>            print output<br/><br/>    print "Logging out of", host2login<br/><br/># Doing work <br/>userlogin()<br/>if os.path.isfile(hostsfile):<br/>    hosts = open(hostsfile, "r")<br/>    while 1:<br/>        host2login = hosts.readline()<br/>        host2login = host2login.replace("\n", "")<br/>        print "Logging into", host2login<br/>        if not host2login:<br/>            break<br/>        else:<br/>            telnet = telnetlib.Telnet(host2login)<br/>            login(devicetype)<br/>            sessioncommands()<br/>    hosts.close()<br/>else:<br/>    host2login = raw_input("Host: ")<br/>    print "Logging into", host2login<br/>    telnet = telnetlib.Telnet(host2login)<br/>    login(devicetype)<br/>    sessioncommands()</pre>