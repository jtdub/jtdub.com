---
layout: post
title: |-
  RHCE Series: Configure a system as an iSCSI initiator that persistently
  mounts an iSCSI target.
date: '2012-10-16T19:04:00.001-05:00'
author: jtdub
tags:
- Linux
- RHCE Study Notes
- ISCSI
modified_time: '2019-04-11T11:09:52.143-05:00'
blogger_id: tag:blogger.com,1999:blog-2200496390325245811.post-5393195239516529917
blogger_orig_url: https://www.packetgeek.net/2012/10/rhce-series-configure-system-as-iscsi_16.html
---

Creating an iscsi target isn't part of the RHCE objectives, but I'll show my commands here so that you can create your own target for testing.
<br/>
<br/>
<br/>
<pre>[root@server1 ~]# yum -y install scsi-target-utils<br/>Loaded plugins: fastestmirror, refresh-packagekit, security<br/>Loading mirror speeds from cached hostfile<br/> * base: mirrors.versaweb.com<br/> * extras: mirror.rackspace.com<br/> * updates: mirrors.greenmountainaccess.net<br/>....<br/>Installed:<br/>  scsi-target-utils.x86_64 0:1.0.24-2.el6 <br/><br/>Complete!<br/><br/>[root@server1 ~]# dd if=/dev/zero of=/targetfs bs=1M count=512<br/>512+0 records in<br/>512+0 records out<br/>536870912 bytes (537 MB) copied, 15.153 s, 35.4 MB/s<br/><br/>[root@server1 ~]# vim /etc/tgt/targets.conf <br/>[root@server1 ~]# tail -4 /etc/tgt/targets.conf <br/><br/> backing-store /targetfs<br/> initiator 192.168.101.0/24<br/><br/>[root@server1 ~]# service tgtd start<br/>Starting SCSI target daemon:                               [  OK  ]<br/>[root@server1 ~]# chkconfig tgtd on<br/>[root@server1 ~]# tgtadm --mode target --op show<br/>Target 1: iqn.192.168.101.1.target<br/>    System information:<br/>        Driver: iscsi<br/>        State: ready<br/>    I_T nexus information:<br/>    LUN information:<br/>        LUN: 0<br/>            Type: controller<br/>            SCSI ID: IET     00010000<br/>            SCSI SN: beaf10<br/>            Size: 0 MB, Block size: 1<br/>            Online: Yes<br/>            Removable media: No<br/>            Prevent removal: No<br/>            Readonly: No<br/>            Backing store type: null<br/>            Backing store path: None<br/>            Backing store flags: <br/>        LUN: 1<br/>            Type: disk<br/>            SCSI ID: IET     00010001<br/>            SCSI SN: beaf11<br/>            Size: 537 MB, Block size: 512<br/>            Online: Yes<br/>            Removable media: No<br/>            Prevent removal: No<br/>            Readonly: Yes<br/>            Backing store type: rdwr<br/>            Backing store path: /targetfs<br/>            Backing store flags: <br/>    Account information:<br/>    ACL information:<br/>        ALL</pre>
<br/>
Once you have your target created. You can get to the actual portion of the RHCE objective. The first thing that you'll need to do is make sure that the iscsi initiator utilities are installed.
<br/>
<br/>
<br/>
<pre>[root@client1 ~]# yum -y install iscsi-initiator-utils<br/>Loaded plugins: fastestmirror, refresh-packagekit, security<br/>Loading mirror speeds from cached hostfile<br/> * base: centos.mirror.constant.com<br/> * extras: mirror.trouble-free.net<br/> * updates: mirror.flhsi.com<br/>...<br/>Running Transaction<br/>  Installing : iscsi-initiator-utils-6.2.0.872-41.el6.x86_64                                                                                                                         1/1 <br/>  Verifying  : iscsi-initiator-utils-6.2.0.872-41.el6.x86_64                                                                                                                         1/1 <br/><br/>Installed:<br/>  iscsi-initiator-utils.x86_64 0:6.2.0.872-41.el6                                                                                                                                        <br/><br/>Complete!</pre>
<br/>
Now, you're ready to start playing with iscsi!
<br/>
<br/>
<br/>
<pre>[root@client1 ~]# iscsiadm -m discovery -t sendtargets -p 192.168.101.1<br/>Starting iscsid:                                           [  OK  ]<br/>192.168.101.1:3260,1 iqn.192.168.101.1.target<br/>[root@client1 ~]# chkconfig iscsid --list<br/>iscsid          0:off 1:off 2:off 3:on 4:on 5:on 6:off</pre>
<br/>
The iscsid service is controlled by the iscsi service. iscsid controls iscsi communications and iscsi automatically logs in and out of targets.
<br/>
<br/>
Once a target is discovered, it will be remembered. You can see your known targets with:
<br/>
<br/>
iscsiadm -m node -o show
<br/>
<br/>
<br/>
<pre>[root@client1 ~]# service iscsi start<br/>Starting iscsi:                                            [  OK  ]<br/>[root@client1 ~]# dmesg | tail -20<br/>libcxgbi:ddp_setup_host_page_size: system PAGE 4096, ddp idx 0.<br/>Chelsio T3 iSCSI Driver cxgb3i v2.0.0 (Jun. 2010)<br/>iscsi: registered transport (cxgb3i)<br/>Chelsio T4 iSCSI Driver cxgb4i v0.9.1 (Aug. 2010)<br/>iscsi: registered transport (cxgb4i)<br/>cnic: Broadcom NetXtreme II CNIC Driver cnic v2.5.10 (March 21, 2012)<br/>Broadcom NetXtreme II iSCSI Driver bnx2i v2.7.2.2 (Apr 26, 2012)<br/>iscsi: registered transport (bnx2i)<br/>iscsi: registered transport (be2iscsi)<br/>scsi2 : iSCSI Initiator over TCP/IP<br/>scsi 2:0:0:0: RAID              IET      Controller       0001 PQ: 0 ANSI: 5<br/>scsi 2:0:0:1: Direct-Access     IET      VIRTUAL-DISK     0001 PQ: 0 ANSI: 5<br/>sd 2:0:0:1: [sda] 1048576 512-byte logical blocks: (536 MB/512 MiB)<br/>sd 2:0:0:1: [sda] Write Protect is on<br/>sd 2:0:0:1: [sda] Mode Sense: 49 00 80 08<br/>sd 2:0:0:1: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA<br/> sda: unknown partition table<br/>sd 2:0:0:1: [sda] Attached SCSI disk<br/>scsi 2:0:0:0: Attached scsi generic sg0 type 12<br/>sd 2:0:0:1: Attached scsi generic sg1 type 0<br/>[root@client1 ~]# chkconfig iscsi on</pre>
<br/>
To make sure that your iscsi drives are mounted persistent on each boot, you'll need to make sure that the iscsi service starts at boot.
<br/>
<br/>
As you can see, my iscsi presented drive is sda. From here, the drive is handled just like you would any other drive - fdisk, mkfs, mount, and add it to the /etc/fstab.
<br/>
<br/>
<br/>
<pre class="crayon-selected">[root@client1 ~]# fdisk -l /dev/sda<br/><br/>Disk /dev/sda: 536 MB, 536870912 bytes<br/>17 heads, 61 sectors/track, 1011 cylinders<br/>Units = cylinders of 1037 * 512 = 530944 bytes<br/>Sector size (logical/physical): 512 bytes / 512 bytes<br/>I/O size (minimum/optimal): 512 bytes / 512 bytes<br/>Disk identifier: 0x00000000</pre>